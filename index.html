<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>İngiliz Kültür Koleji - Tanışma Randevusu</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ea580c; --primary-dark: #c2410c;
            --secondary: #1e3a8a; --bg: #f8fafc; --white: #ffffff;
        }
        body { font-family: 'Outfit', sans-serif; background-color: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; color: #334155; }
        .container { background-color: var(--white); padding: 40px; border-radius: 20px; box-shadow: 0 20px 40px -10px rgba(0,0,0,0.1); width: 100%; max-width: 500px; border-top: 6px solid var(--secondary); position: relative; }
        .logo { display: block; max-width: 180px; margin: 0 auto 20px; }
        h2 { text-align: center; color: var(--secondary); margin-bottom: 10px; font-weight: 800; font-size: 1.8rem; }
        .subtitle { text-align: center; color: #64748b; margin-bottom: 30px; font-size: 0.95rem; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--secondary); font-size: 0.9rem; }
        input, select { width: 100%; padding: 14px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 16px; box-sizing: border-box; transition: 0.3s; font-family: 'Outfit', sans-serif; }
        input:focus, select:focus { border-color: var(--primary); outline: none; background-color: #fff7ed; }
        
        .room-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px; }
        .room-card { background: #fff; border: 2px solid #e2e8f0; border-radius: 10px; padding: 12px; text-align: center; cursor: pointer; font-weight: 600; color: #64748b; font-size: 0.9rem; }
        .room-card.selected { border-color: var(--secondary); background-color: var(--secondary); color: white; }
        .hidden-room { display: none !important; }

        /* GÜVENLİK KUTUSU */
        .security-box { background: #f1f5f9; padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid var(--primary); }
        .checkbox-group { display: flex; align-items: flex-start; gap: 10px; font-size: 0.85rem; margin-bottom: 12px; cursor: pointer;}
        .checkbox-group input { width: 18px; height: 18px; cursor: pointer; margin-top: 2px; }
        .checkbox-group a { color: var(--primary); text-decoration: underline; font-weight: 700; }
        
        .math-captcha { display: flex; align-items: center; gap: 10px; margin-top: 15px; border-top: 1px solid #cbd5e1; padding-top: 15px; }
        .math-captcha span { font-weight: 800; color: var(--secondary); font-size: 1.1rem; }
        .math-captcha input { width: 80px; text-align: center; margin: 0; }

        button#submitButton { width: 100%; padding: 18px; background-color: var(--primary); color: white; border: none; border-radius: 12px; font-size: 18px; font-weight: 800; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 15px rgba(234, 88, 12, 0.3); }
        button#submitButton:hover:not(:disabled) { background-color: var(--primary-dark); transform: translateY(-2px); }
        button:disabled { background-color: #cbd5e1; cursor: not-allowed; box-shadow: none; transform: none; }

        #statusMessage { text-align: center; margin-top: 20px; padding: 15px; border-radius: 10px; font-weight: 600; display: none; }
        .success { background-color: #dcfce7; color: #166534; }
        .error { background-color: #fee2e2; color: #991b1b; }

        /* KVKK MODAL (AÇILIR PENCERE) STİLİ */
        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
        }
        .modal-content {
            background-color: #fefefe; margin: 5% auto; padding: 30px; border: 1px solid #888; width: 90%; max-width: 600px; border-radius: 15px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); position: relative;
        }
        .close-btn { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .close-btn:hover { color: #000; }
        .kvkk-text { max-height: 400px; overflow-y: auto; font-size: 0.9rem; line-height: 1.6; color: #334155; padding-right: 10px; margin-top: 20px; border: 1px solid #e2e8f0; padding: 15px; border-radius: 8px; background: #f8fafc; }
        .kvkk-title { color: var(--secondary); font-weight: 800; margin-bottom: 10px; font-size: 1.2rem; }
    </style>
</head>
<body>

    <div class="container">
        <img src="https://i.hizliresim.com/6eldhh1.png" alt="Okul Logosu" class="logo">
        <h2>Erken Kayıt Fırsatı</h2>
        <p class="subtitle">Çocuğunuzun geleceği için bir kahve içelim.</p>
        
        <form id="appointmentForm">
            <div class="form-group">
                <label>Veli Adı Soyadı</label>
                <input type="text" name="veliAdiSoyadi" required placeholder="Adınız Soyadınız">
            </div>

            <div class="form-group">
                <label>Öğrenci Adı Soyadı</label>
                <input type="text" name="ogrenciAdiSoyadi" required placeholder="Öğrencinin Adı">
            </div>
            
            <div class="form-group">
                <label>İletişim Numarası</label>
                <input type="tel" id="phoneInput" name="telefon" required placeholder="(5XX) XXX XX XX" maxlength="15">
            </div>

            <div class="form-group">
                <label>Öğrenci Sınıfı</label>
                <select name="ogrenciSinifi" required>
                    <option value="">Sınıf Seçiniz</option>
                    <option value="Anaokulu">Anaokulu</option>
                    <option value="1. Sınıf">1. Sınıf</option>
                    <option value="2. Sınıf">2. Sınıf</option>
                    <option value="3. Sınıf">3. Sınıf</option>
                    <option value="4. Sınıf">4. Sınıf</option>
                    <option value="5. Sınıf">5. Sınıf</option>
                    <option value="6. Sınıf">6. Sınıf</option>
                    <option value="7. Sınıf">7. Sınıf</option>
                    <option value="8. Sınıf">8. Sınıf</option>
                </select>
            </div>

            <div class="form-group">
                <label>Görüşme Tarihi</label>
                <input type="date" id="randevuTarihi" name="randevuTarihi" required>
            </div>

            <div class="form-group">
                <label>Müsait Danışman/Oda</label>
                <div class="room-container">
                    <div class="room-card" id="room-manchester" onclick="selectRoom('Manchester', this)">Manchester</div>
                    <div class="room-card" id="room-liverpool" onclick="selectRoom('Liverpool', this)">Liverpool</div>
                    <div class="room-card" id="room-cambridge" onclick="selectRoom('Cambridge', this)">Cambridge</div>
                    <div class="room-card" id="room-oxford" onclick="selectRoom('Oxford', this)">Oxford</div>
                </div>
                <input type="hidden" id="secilenOda" name="secilenOda">
                <div id="roomWarning" style="display:none; color:red; font-size:0.8rem;">Lütfen tarih seçiniz.</div>
            </div>

            <div class="form-group">
                <label>Randevu Saati</label>
                <select id="randevuSaati" name="randevuSaati" required disabled>
                    <option value="">Önce Oda Seçiniz</option>
                </select>
            </div>

            <div class="security-box">
                <label class="checkbox-group">
                    <input type="checkbox" id="parentCheck" required>
                    <span>Öğrencinin yasal velisi olduğumu onaylıyorum.</span>
                </label>

                <label class="checkbox-group">
                    <input type="checkbox" id="kvkkCheck" required>
                    <span>
                        <a href="#" id="kvkkLink">KVKK Aydınlatma Metni</a>'ni okudum ve onaylıyorum.
                    </span>
                </label>
                
                <div class="math-captcha">
                    <span id="captchaQuestion">3 + 4 = ?</span>
                    <input type="number" id="captchaInput" placeholder="Sonuç" required>
                </div>
            </div>

            <button type="submit" id="submitButton">Randevu Oluştur</button>
            <div id="statusMessage"></div>
        </form>
    </div>

    <div id="kvkkModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <div class="kvkk-title">KVKK Aydınlatma Metni</div>
            <div class="kvkk-text">
                <p><strong>1. Veri Sorumlusu</strong><br>
                İngiliz Kültür Koleji olarak kişisel verilerinizi 6698 sayılı Kişisel Verilerin Korunması Kanunu ("KVKK") kapsamında aşağıda açıklanan amaçlarla işlemekteyiz.</p>
                
                <p><strong>2. İşlenen Kişisel Veriler</strong><br>
                Randevu oluşturma sürecinde; Adınız, Soyadınız, Telefon Numaranız ve Öğrenci Bilgileriniz işlenmektedir.</p>
                
                <p><strong>3. İşleme Amacı</strong><br>
                Bu veriler, randevu oluşturmak, sizinle iletişime geçmek ve eğitim hizmetlerimiz hakkında bilgi vermek amacıyla işlenmektedir.</p>
                
                <p><strong>4. Veri Aktarımı</strong><br>
                Kişisel verileriniz yasal zorunluluklar dışında üçüncü kişilerle paylaşılmamaktadır.</p>
                
                <p><strong>5. Haklarınız</strong><br>
                KVKK'nın 11. maddesi gereği verilerinizin silinmesini veya düzeltilmesini talep etme hakkına sahipsiniz.</p>
                
                <p><em>(Not: Bu metin standart bir örnektir. Lütfen kurumunuzun resmi hukuk metni ile güncelleyiniz.)</em></p>
            </div>
        </div>
    </div>

    <script>
        // URL'NİZİ BURAYA YAPIŞTIRIN
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxrgOTD9W4YDnNrIN-8xpg3RV--XaRpOuM8o-FVlp2_zgwglBSueTkvPiErV61wW1w-/exec';

        const dateInput = document.getElementById('randevuTarihi');
        const timeSelect = document.getElementById('randevuSaati');
        const roomInput = document.getElementById('secilenOda');
        const phoneInput = document.getElementById('phoneInput');
        
        // KVKK Modal İşlemleri
        const modal = document.getElementById("kvkkModal");
        const btnLink = document.getElementById("kvkkLink");
        const span = document.getElementsByClassName("close-btn")[0];

        btnLink.onclick = function(e) {
            e.preventDefault();
            modal.style.display = "block";
        }
        span.onclick = function() { modal.style.display = "none"; }
        window.onclick = function(event) {
            if (event.target == modal) { modal.style.display = "none"; }
        }

        // Captcha Hazırlık
        let captchaResult = 0;
        function generateCaptcha() {
            const n1 = Math.floor(Math.random() * 10) + 1;
            const n2 = Math.floor(Math.random() * 10) + 1;
            captchaResult = n1 + n2;
            document.getElementById('captchaQuestion').textContent = `${n1} + ${n2} = ?`;
        }
        generateCaptcha();

        let currentBookings = []; 
        const currentYear = new Date().getFullYear();
        dateInput.setAttribute('min', `${currentYear}-12-01`);
        dateInput.setAttribute('max', `${currentYear + 1}-01-01`);

        phoneInput.addEventListener('input', function (e) {
            var x = e.target.value.replace(/\D/g, '').match(/(\d{0,3})(\d{0,3})(\d{0,2})(\d{0,2})/);
            e.target.value = !x[2] ? x[1] : '(' + x[1] + ') ' + x[2] + (x[3] ? ' ' + x[3] : '') + (x[4] ? ' ' + x[4] : '');
        });

        dateInput.addEventListener('change', async function() {
            if (!this.value) return;
            resetRooms();
            const day = new Date(this.value).getDay();
            const rLiv = document.getElementById('room-liverpool');
            const rMan = document.getElementById('room-manchester');
            const rOx = document.getElementById('room-oxford');
            const rCam = document.getElementById('room-cambridge');

            rLiv.classList.remove('hidden-room'); rMan.classList.remove('hidden-room');
            rOx.classList.remove('hidden-room'); rCam.classList.remove('hidden-room');

            if (day === 0) { 
                rMan.classList.add('hidden-room');
                rOx.classList.add('hidden-room');
            } else if (day === 6) { 
            } else { 
                rLiv.classList.add('hidden-room');
            }

            try {
                const res = await fetch(`${SCRIPT_URL}?date=${this.value}`);
                const data = await res.json();
                if(data.result === 'success') currentBookings = data.bookings;
            } catch(e) { console.log(e); }
        });

        function selectRoom(name, el) {
            if(!dateInput.value) { document.getElementById('roomWarning').style.display='block'; return; }
            document.querySelectorAll('.room-card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            roomInput.value = name;
            generateSlots(name, new Date(dateInput.value).getDay() === 0);
        }

        function generateSlots(room, isSunday) {
            timeSelect.innerHTML = '';
            timeSelect.disabled = false;
            
            for(let h=9; h<=17; h++) {
                for(let m=0; m<60; m+=20) {
                    if(h===12 && m===40) continue;
                    if(h===13 && m===0) continue;
                    
                    if(isSunday) {
                        if(h<10) continue; 
                        if(h===10 && m<30) continue;
                        if(h>16) continue;
                        if(h===16 && m>0) continue;
                    } else {
                        if(h===17 && m>0) continue;
                    }

                    let time = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
                    if(!currentBookings.includes(`${room}-${time}`)) {
                        let opt = document.createElement('option');
                        opt.value = time;
                        opt.innerText = time;
                        timeSelect.appendChild(opt);
                    }
                }
            }
        }

        function resetRooms() {
            document.querySelectorAll('.room-card').forEach(c => c.classList.remove('selected'));
            roomInput.value = '';
            timeSelect.innerHTML = '<option>Önce Oda Seçiniz</option>';
            timeSelect.disabled = true;
        }

        document.getElementById('appointmentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const msg = document.getElementById('statusMessage');
            
            if(!roomInput.value) { alert("Lütfen bir oda seçiniz."); return; }

            // GÜVENLİK KONTROLLERİ
            const captchaVal = parseInt(document.getElementById('captchaInput').value);
            if(captchaVal !== captchaResult) {
                msg.innerHTML = '⚠️ Matematik sorusu yanlış! Tekrar deneyin.';
                msg.className = 'error'; msg.style.display = 'block';
                generateCaptcha(); document.getElementById('captchaInput').value='';
                return;
            }

            const phoneVal = phoneInput.value;
            if(phoneVal.length < 14) {
                msg.innerHTML = '⚠️ Lütfen geçerli bir telefon numarası giriniz.';
                msg.className = 'error'; msg.style.display = 'block';
                return;
            }

            if(!document.getElementById('kvkkCheck').checked) {
                msg.innerHTML = '⚠️ Lütfen KVKK metnini onaylayınız.';
                msg.className = 'error'; msg.style.display = 'block';
                return;
            }

            const btn = document.getElementById('submitButton');
            btn.disabled = true;
            btn.innerText = 'Gönderiliyor...';

            const formData = new FormData(this);
            fetch(SCRIPT_URL, {
                method: 'POST', body: JSON.stringify(Object.fromEntries(formData.entries()))
            })
            .then(r => r.json())
            .then(d => {
                if(d.result === 'error') {
                    msg.innerText = '⚠️ ' + d.message;
                    msg.className = 'error';
                } else {
                    msg.innerText = '✅ Randevunuz başarıyla oluşturuldu! Sizi arayacağız.';
                    msg.className = 'success';
                    this.reset();
                    resetRooms();
                    generateCaptcha();
                }
                msg.style.display = 'block';
            })
            .catch(() => {
                msg.innerText = 'Hata oluştu.'; msg.className='error'; msg.style.display='block';
            })
            .finally(() => {
                btn.disabled = false; btn.innerText = 'Randevu Oluştur';
            });
        });
    </script>
</body>
</html>
