<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Randevu Al</title>

<style>
.time {
  padding:8px;
  margin:6px;
  border:1px solid #ccc;
  display:inline-block;
  cursor:pointer;
}
.disabled {
  background:#e0e0e0;
  cursor:not-allowed;
}
.active {
  background:#2e7d32;
  color:#fff;
}
</style>
</head>

<body>

<h3>Randevu Al</h3>

<input id="veli" placeholder="Veli Adı Soyadı"><br><br>
<input id="ogrenci" placeholder="Öğrenci Adı Soyadı"><br><br>
<input id="sinif" placeholder="Öğrenci Sınıfı"><br><br>
<input id="tel" placeholder="5XXXXXXXXX"><br><br>

<input type="date" id="date"><br><br>

<select id="room">
  <option value="Oxford">Oxford</option>
</select>

<h4>Saat Seçiniz</h4>
<div id="times"></div>

<br>
<button onclick="submitForm()">Randevu Al</button>

<script>
const WEBAPP_URL = "WEB_APP_URLİNİ_BURAYA_YAPIŞTIR";

const TIMES = [
 "09:00","09:30","10:00","10:30",
 "11:00","11:30","13:00","13:30",
 "14:00","14:30","15:00","15:30"
];

let selectedTime = "";

document.getElementById("date").addEventListener("change", loadTimes);

function loadTimes() {
  const d = new Date(date.value);

  // ❌ Pazar kapalı
  if (d.getDay() === 0) {
    alert("Pazar günü kapalıyız.");
    date.value = "";
    return;
  }

  times.innerHTML = "";
  selectedTime = "";

  fetch(`${WEBAPP_URL}?date=${date.value}&room=Oxford`)
    .then(r => r.json())
    .then(data => {
      TIMES.forEach(t => {
        const div = document.createElement("div");
        div.className = "time";
        div.innerText = t;

        if (data.taken.includes(t)) {
          div.classList.add("disabled");
        } else {
          div.onclick = () => selectTime(div, t);
        }

        times.appendChild(div);
      });
    });
}

function selectTime(el, time) {
  document.querySelectorAll(".time").forEach(x => x.classList.remove("active"));
  el.classList.add("active");
  selectedTime = time;
}

function submitForm() {
  if (!selectedTime) {
    alert("Lütfen saat seçiniz");
    return;
  }

  fetch(WEBAPP_URL, {
    method: "POST",
    body: JSON.stringify({
      veliAdiSoyadi: veli.value,
      ogrenciAdiSoyadi: ogrenci.value,
      ogrenciSinifi: sinif.value,
      telefon: tel.value,
      randevuTarihi: date.value,
      randevuSaati: selectedTime,
      secilenOda: "Oxford"
    })
  })
  .then(r => r.json())
  .then(res => {
    if (res.result === "success") {
      alert("Randevu başarıyla alındı");
      location.reload();
    } else {
      alert(res.message);
    }
  });
}
</script>

</body>
</html>
